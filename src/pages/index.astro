---
import Layout from '@/layouts/Layout.astro';
import { getPageData } from '@/lib/helpers';
import Hero from '@/components/pages/home/Hero.astro';
import type { HomePageData } from '@/lib/types/homePage';
import { picture } from 'astro-sanity-picture';
import LegacyToEfficiency from '@/components/pages/home/legacy/LegacyToEfficiency.astro';

const query = `*[_type == 'homePage'][0] {
  ...,
  sections[]{
    ...,
    flowDiagram[]{
      _key,
      name,
      platform,
      root,
      "iconUrl": icon.asset->url,
    },
    businessSolutions[]{
      ...,
      ${picture('icon')}
    }
  }
}`;

const data = await getPageData<HomePageData>(query);
const { page, site } = data;
const { sections, seo } = page;

console.log(sections);
---

<Layout seo={seo} site={site}>
  {
    sections.map((section) => {
      switch (section._type) {
        case 'homePage.hero':
          return <Hero {...section} />;
        case 'homePage.legacyToEfficiency':
          return <LegacyToEfficiency {...section} />;
        default:
          return null;
      }
    })
  }
</Layout>
